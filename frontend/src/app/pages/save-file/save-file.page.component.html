<div class="container p-5">
  @if (saveState$ | async; as save) {
    <h1>{{ save.name }}</h1>
    <h2>{{ 'date: ' + save.date }}</h2>
    <div>{{ save.description ?? 'no description provided.' }}</div>
  } @else {
    <i>loading save...</i>
  }

  <div class="row mt-2 mb-1">
    <input type="text" [formControl]="objectSearch">
  </div>
  <div class="row mb-2 gap-1">
    <!-- less ugly icons for going up (both here and the deck selector)-->
    <button type="button" class="col-auto btn btn-secondary" (click)="goUpCollection()"><i class="bi bi-arrow-up"></i>
    </button>
    @for (collectionRef of collections$ | async; track $index) {
      @if (collectionRef.object; as collection) {
        @if (collection.Nickname.trim().length > 0) {
          <button class="col-auto btn btn-secondary" (click)="collectionPressed(collectionRef.jsonRelPath)"
          >{{ collection.Nickname }}
            <span
              class="ms-1 badge rounded-pill bg-body-tertiary text-dark">{{ collection.ContainedObjects?.length ?? 0 }}</span>
          </button>
        } @else {
          <button class="col-auto btn btn-secondary" (click)="collectionPressed(collectionRef.jsonRelPath)"
          ><i>{{ collection.Name }}</i>
            <span
              class="ms-1 badge rounded-pill bg-body-tertiary text-dark">{{ collection.ContainedObjects?.length ?? 0 }}</span>
          </button>
        }
      }
    }
  </div>

  <!-- header end, card list -->

  @if (cardForms$ | async; as cardForms) {
    @for (cardForm of cardForms | keyvalue; track $index) {
      <div>{{ cardForm.key }}</div>
      <app-custom-card-editor [form]="cardForm.value"></app-custom-card-editor>
    }

  } @else {
    <i>savefile contains no objects</i>
  }

  <!-- TODO new card creator -->

</div>
